console.log("[Content] this is content script");let defaultToCurrency="USD";const currencyData=[{Symbol:"$",Abbreviation:"USD"},{Symbol:"€",Abbreviation:"EUR"},{Symbol:"دإ",Abbreviation:"AED"},{Symbol:"؋",Abbreviation:"AFN"},{Symbol:"Lek",Abbreviation:"ALL"},{Symbol:"դր",Abbreviation:"AMD"},{Symbol:"ман",Abbreviation:"AZN"},{Symbol:"KM",Abbreviation:"BAM"},{Symbol:"৳",Abbreviation:"BDT"},{Symbol:"лв",Abbreviation:"BGN"},{Symbol:"دب",Abbreviation:"BHD"},{Symbol:"FBu",Abbreviation:"BIF"},{Symbol:"Bs",Abbreviation:"BOB"},{Symbol:"R$",Abbreviation:"BRL"},{Symbol:"P",Abbreviation:"BWP"},{Symbol:"руб",Abbreviation:"BYN"},{Symbol:"FrCD",Abbreviation:"CDF"},{Symbol:"CHF",Abbreviation:"CHF"},{Symbol:"CN¥",Abbreviation:"CNY"},{Symbol:"₡",Abbreviation:"CRC"},{Symbol:"CV$",Abbreviation:"CVE"},{Symbol:"Kč",Abbreviation:"CZK"},{Symbol:"Fdj",Abbreviation:"DJF"},{Symbol:"kr",Abbreviation:"DKK"},{Symbol:"RD$",Abbreviation:"DOP"},{Symbol:"دج",Abbreviation:"DZD"},{Symbol:"جم",Abbreviation:"EGP"},{Symbol:"Nfk",Abbreviation:"ERN"},{Symbol:"Br",Abbreviation:"ETB"},{Symbol:"£",Abbreviation:"GBP"},{Symbol:"GEL",Abbreviation:"GEL"},{Symbol:"₵",Abbreviation:"GHS"},{Symbol:"FG",Abbreviation:"GNF"},{Symbol:"Q",Abbreviation:"GTQ"},{Symbol:"L",Abbreviation:"HNL"},{Symbol:"kn",Abbreviation:"HRK"},{Symbol:"Ft",Abbreviation:"HUF"},{Symbol:"Rp",Abbreviation:"IDR"},{Symbol:"₪",Abbreviation:"ILS"},{Symbol:"টকা",Abbreviation:"INR"},{Symbol:"دع",Abbreviation:"IQD"},{Symbol:"﷼",Abbreviation:"IRR"},{Symbol:"دأ",Abbreviation:"JOD"},{Symbol:"￥",Abbreviation:"JPY"},{Symbol:"Ksh",Abbreviation:"KES"},{Symbol:"៛",Abbreviation:"KHR"},{Symbol:"FC",Abbreviation:"KMF"},{Symbol:"₩",Abbreviation:"KRW"},{Symbol:"دك",Abbreviation:"KWD"},{Symbol:"тңг",Abbreviation:"KZT"},{Symbol:"لل",Abbreviation:"LBP"},{Symbol:"SL Re",Abbreviation:"LKR"},{Symbol:"Lt",Abbreviation:"LTL"},{Symbol:"Ls",Abbreviation:"LVL"},{Symbol:"دل",Abbreviation:"LYD"},{Symbol:"دم",Abbreviation:"MAD"},{Symbol:"K",Abbreviation:"MMK"},{Symbol:"RM",Abbreviation:"MYR"},{Symbol:"MTn",Abbreviation:"MZN"},{Symbol:"N$",Abbreviation:"NAD"},{Symbol:"₦",Abbreviation:"NGN"},{Symbol:"C$",Abbreviation:"NIO"},{Symbol:"नेरू",Abbreviation:"NPR"},{Symbol:"رع",Abbreviation:"OMR"},{Symbol:"B/.",Abbreviation:"PAB"},{Symbol:"S/.",Abbreviation:"PEN"},{Symbol:"₱",Abbreviation:"PHP"},{Symbol:"₨",Abbreviation:"PKR"},{Symbol:"zł",Abbreviation:"PLN"},{Symbol:"₲",Abbreviation:"PYG"},{Symbol:"رق",Abbreviation:"QAR"},{Symbol:"дин",Abbreviation:"RSD"},{Symbol:"₽",Abbreviation:"RUB"},{Symbol:"FR",Abbreviation:"RWF"},{Symbol:"رس",Abbreviation:"SAR"},{Symbol:"Ssh",Abbreviation:"SOS"},{Symbol:"لس",Abbreviation:"SYP"},{Symbol:"฿",Abbreviation:"THB"},{Symbol:"دت",Abbreviation:"TND"},{Symbol:"T$",Abbreviation:"TOP"},{Symbol:"TL",Abbreviation:"TRY"},{Symbol:"NT$",Abbreviation:"TWD"},{Symbol:"TSh",Abbreviation:"TZS"},{Symbol:"₴",Abbreviation:"UAH"},{Symbol:"USh",Abbreviation:"UGX"},{Symbol:"Bs.F.",Abbreviation:"VEF"},{Symbol:"₫",Abbreviation:"VND"},{Symbol:"FCFA",Abbreviation:"XAF"},{Symbol:"CFA",Abbreviation:"XOF"},{Symbol:"ري",Abbreviation:"YER"},{Symbol:"R",Abbreviation:"ZAR"},{Symbol:"ZK",Abbreviation:"ZMK"}];async function fetchAndCacheRates(){try{console.log("Fetching data...");const o="https://currency-converter-e1ym.onrender.com/api",e=await fetch(o);if(console.log("Suppppp data..."),!e)throw console.log("Failed to fetch data"),new Error("Failed to fetch data");const t=await e.json(),b={data:t.quotes,timestamp:Date.now()};return console.log("Printing data....: "),console.log(t.quotes),await chrome.storage.local.set({exchangeRates:b}),t.quotes}catch(o){throw console.log("CANT FETCH DATA"),o}}async function convertCurrency(o,e,t){const b=await retrieveCache();let i;return i="USD"===e?b[`USD${t}`]:"USD"===t?1/b[`USD${e}`]:b[`USD${t}`]/b[`USD${e}`],o*i}async function retrieveCache(){const o=(await chrome.storage.local.get(["exchangeRates"])).exchangeRates;return o&&o.data?Date.now()-o.timestamp>288e5?(console.log("Data expired, doing another API call..."),await chrome.storage.local.remove("exchangeRates"),await fetchAndCacheRates()):(console.log("Returning cached data..."),o.data):(console.log("No data found, doing initial API call..."),await fetchAndCacheRates())}async function updateCurrencyFromStorage(){const o=await chrome.storage.local.get(["selectedCurrency"]);o.selectedCurrency&&(defaultToCurrency=o.selectedCurrency,console.log("[Content] Updated default currency to:",defaultToCurrency))}async function extractCurrencyAndAmount(o){const e=o.match(/[\d,\.]+/);let t=null;if(e){const o=e.map((o=>o.includes(",")&&o.includes(".")?o.indexOf(",")<o.indexOf(".")?o.replace(/,/g,""):o.replace(/\./g,"").replace(/,/g,"."):o.includes(",")?(o.match(/,/)||[]).length>1||3===o.split(",")[1].length?o.replace(/,/g,""):o.replace(/,/g,"."):1==(o.match(/\./g)||[]).length?3===o.split(".")[1].length?o.replace(/\./g,""):o:o.replace(/\./g,"")));t=parseFloat(o[0])}let b=o.match(/[A-Z]{3}/);if(b)return"YEN"==b?b="JPY":"CFA"==b?b="XOF":"FCF"==b?b="XAF":"FCD"==b&&(b="CDF"),console.log("Amount: ",t),console.log("Currency: ",b),{currency:b,number:t};for(let e=0;e<currencyData.length;e++)if(o.includes(currencyData[e].Symbol))return console.log("Amount: ",t),console.log("Currency: ",currencyData[e].Abbreviation),{currency:currencyData[e].Abbreviation,number:t}}function createPopup(o,e){var t=document.createElement("div");t.style.position="fixed",t.style.top=e.top-50+"px",t.style.left=e.left+"px",t.style.backgroundColor="#fff",t.style.border="1px solid #000",t.style.padding="10px";var b=document.createElement("div");return b.textContent=defaultToCurrency+" "+o,t.appendChild(b),t.id="myPopup",t}document.addEventListener("mouseup",(async o=>{var e=window.getSelection(),t=e.toString().trim();if(console.log("[Content] selection: "+e),t&&""!==t){var b=e.getRangeAt(0).getBoundingClientRect();try{await updateCurrencyFromStorage();const o=await extractCurrencyAndAmount(t),e=createPopup((await convertCurrency(o.number,o.currency,defaultToCurrency)).toFixed(2),b);document.body.appendChild(e),document.addEventListener("mousedown",(function(o){e.contains(o.target)||(e.parentNode.removeChild(e),document.removeEventListener("mousedown",arguments.callee))}))}catch(o){throw o}}}));