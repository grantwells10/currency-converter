console.log("[Content] this is content script");let defaultToCurrency="USD";const currencyData=[{Symbol:"$",Abbreviation:"USD"},{Symbol:"€",Abbreviation:"EUR"},{Symbol:"دإ",Abbreviation:"AED"},{Symbol:"؋",Abbreviation:"AFN"},{Symbol:"Lek",Abbreviation:"ALL"},{Symbol:"դր",Abbreviation:"AMD"},{Symbol:"ман",Abbreviation:"AZN"},{Symbol:"KM",Abbreviation:"BAM"},{Symbol:"৳",Abbreviation:"BDT"},{Symbol:"лв",Abbreviation:"BGN"},{Symbol:"دب",Abbreviation:"BHD"},{Symbol:"FBu",Abbreviation:"BIF"},{Symbol:"Bs",Abbreviation:"BOB"},{Symbol:"R$",Abbreviation:"BRL"},{Symbol:"P",Abbreviation:"BWP"},{Symbol:"руб",Abbreviation:"BYN"},{Symbol:"FrCD",Abbreviation:"CDF"},{Symbol:"CHF",Abbreviation:"CHF"},{Symbol:"CN¥",Abbreviation:"CNY"},{Symbol:"₡",Abbreviation:"CRC"},{Symbol:"CV$",Abbreviation:"CVE"},{Symbol:"Kč",Abbreviation:"CZK"},{Symbol:"Fdj",Abbreviation:"DJF"},{Symbol:"kr",Abbreviation:"DKK"},{Symbol:"RD$",Abbreviation:"DOP"},{Symbol:"دج",Abbreviation:"DZD"},{Symbol:"جم",Abbreviation:"EGP"},{Symbol:"Nfk",Abbreviation:"ERN"},{Symbol:"Br",Abbreviation:"ETB"},{Symbol:"£",Abbreviation:"GBP"},{Symbol:"GEL",Abbreviation:"GEL"},{Symbol:"₵",Abbreviation:"GHS"},{Symbol:"FG",Abbreviation:"GNF"},{Symbol:"Q",Abbreviation:"GTQ"},{Symbol:"L",Abbreviation:"HNL"},{Symbol:"kn",Abbreviation:"HRK"},{Symbol:"Ft",Abbreviation:"HUF"},{Symbol:"Rp",Abbreviation:"IDR"},{Symbol:"₪",Abbreviation:"ILS"},{Symbol:"টকা",Abbreviation:"INR"},{Symbol:"دع",Abbreviation:"IQD"},{Symbol:"﷼",Abbreviation:"IRR"},{Symbol:"دأ",Abbreviation:"JOD"},{Symbol:"￥",Abbreviation:"JPY"},{Symbol:"Ksh",Abbreviation:"KES"},{Symbol:"៛",Abbreviation:"KHR"},{Symbol:"FC",Abbreviation:"KMF"},{Symbol:"₩",Abbreviation:"KRW"},{Symbol:"دك",Abbreviation:"KWD"},{Symbol:"тңг",Abbreviation:"KZT"},{Symbol:"لل",Abbreviation:"LBP"},{Symbol:"SL Re",Abbreviation:"LKR"},{Symbol:"Lt",Abbreviation:"LTL"},{Symbol:"Ls",Abbreviation:"LVL"},{Symbol:"دل",Abbreviation:"LYD"},{Symbol:"دم",Abbreviation:"MAD"},{Symbol:"K",Abbreviation:"MMK"},{Symbol:"RM",Abbreviation:"MYR"},{Symbol:"MTn",Abbreviation:"MZN"},{Symbol:"N$",Abbreviation:"NAD"},{Symbol:"₦",Abbreviation:"NGN"},{Symbol:"C$",Abbreviation:"NIO"},{Symbol:"नेरू",Abbreviation:"NPR"},{Symbol:"رع",Abbreviation:"OMR"},{Symbol:"B/.",Abbreviation:"PAB"},{Symbol:"S/.",Abbreviation:"PEN"},{Symbol:"₱",Abbreviation:"PHP"},{Symbol:"₨",Abbreviation:"PKR"},{Symbol:"zł",Abbreviation:"PLN"},{Symbol:"₲",Abbreviation:"PYG"},{Symbol:"رق",Abbreviation:"QAR"},{Symbol:"дин",Abbreviation:"RSD"},{Symbol:"₽",Abbreviation:"RUB"},{Symbol:"FR",Abbreviation:"RWF"},{Symbol:"رس",Abbreviation:"SAR"},{Symbol:"Ssh",Abbreviation:"SOS"},{Symbol:"لس",Abbreviation:"SYP"},{Symbol:"฿",Abbreviation:"THB"},{Symbol:"دت",Abbreviation:"TND"},{Symbol:"T$",Abbreviation:"TOP"},{Symbol:"TL",Abbreviation:"TRY"},{Symbol:"NT$",Abbreviation:"TWD"},{Symbol:"TSh",Abbreviation:"TZS"},{Symbol:"₴",Abbreviation:"UAH"},{Symbol:"USh",Abbreviation:"UGX"},{Symbol:"Bs.F.",Abbreviation:"VEF"},{Symbol:"₫",Abbreviation:"VND"},{Symbol:"FCFA",Abbreviation:"XAF"},{Symbol:"CFA",Abbreviation:"XOF"},{Symbol:"ري",Abbreviation:"YER"},{Symbol:"R",Abbreviation:"ZAR"},{Symbol:"ZK",Abbreviation:"ZMK"}];async function fetchAndCacheRates(){try{const o="https://currency-converter-e1ym.onrender.com/api",e=await fetch(o);if(!e)throw new Error("Failed to fetch data");const b=await e.json(),t={data:b.quotes,timestamp:Date.now()};return console.log("Printing data....: "),console.log(b.quotes),await chrome.storage.local.set({exchangeRates:t}),b.quotes}catch(o){throw console.log("CANT FETCH DATA"),o}}async function convertCurrency(o,e,b){const t=await retrieveCache();let i;return i="USD"===e?t[`USD${b}`]:"USD"===b?1/t[`USD${e}`]:t[`USD${b}`]/t[`USD${e}`],o*i}async function retrieveCache(){const o=(await chrome.storage.local.get(["exchangeRates"])).exchangeRates;return o&&o.data?Date.now()-o.timestamp>288e5?(console.log("Data expired, doing another API call..."),await chrome.storage.local.remove("exchangeRates"),await fetchAndCacheRates()):(console.log("Returning cached data..."),o.data):(console.log("No data found, doing initial API call..."),await fetchAndCacheRates())}async function updateCurrencyFromStorage(){const o=await chrome.storage.local.get(["selectedCurrency"]);o.selectedCurrency&&(defaultToCurrency=o.selectedCurrency,console.log("[Content] Updated default currency to:",defaultToCurrency))}async function extractCurrencyAndAmount(o){const e=o.match(/[\d,]+\.?\d*/);let b=null;e&&(b=parseFloat(e[0].replace(/,/g,"")));const t=o.match(/[A-Z]{3}/);if(t)return{currency:t[0],number:b};for(let e=0;e<currencyData.length;e++)if(o.includes(currencyData[e].Symbol))return{currency:currencyData[e].Abbreviation,number:b}}function createPopup(o,e){var b=document.createElement("div");b.style.position="fixed",b.style.top=e.top-50+"px",b.style.left=e.left+"px",b.style.backgroundColor="#fff",b.style.border="1px solid #000",b.style.padding="10px";var t=document.createElement("div");return t.textContent=defaultToCurrency+" "+o,b.appendChild(t),b.id="myPopup",b}document.addEventListener("mouseup",(async o=>{var e=window.getSelection(),b=e.toString().trim();if(console.log("[Content] selection: "+e),b&&""!==b){var t=e.getRangeAt(0).getBoundingClientRect();try{await updateCurrencyFromStorage();const o=await extractCurrencyAndAmount(b),e=createPopup((await convertCurrency(o.number,o.currency,defaultToCurrency)).toFixed(2),t);document.body.appendChild(e),document.addEventListener("mousedown",(function(o){e.contains(o.target)||(e.parentNode.removeChild(e),document.removeEventListener("mousedown",arguments.callee))}))}catch(o){throw o}}}));