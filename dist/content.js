console.log("[Content] this is content script");let defaultToCurrency="USD";const currencyData=[{Symbol:"$",Abbreviation:"USD"},{Symbol:"€",Abbreviation:"EUR"},{Symbol:"دإ",Abbreviation:"AED"},{Symbol:"؋",Abbreviation:"AFN"},{Symbol:"Lek",Abbreviation:"ALL"},{Symbol:"դր",Abbreviation:"AMD"},{Symbol:"ман",Abbreviation:"AZN"},{Symbol:"KM",Abbreviation:"BAM"},{Symbol:"৳",Abbreviation:"BDT"},{Symbol:"лв",Abbreviation:"BGN"},{Symbol:"دب",Abbreviation:"BHD"},{Symbol:"FBu",Abbreviation:"BIF"},{Symbol:"Bs",Abbreviation:"BOB"},{Symbol:"R$",Abbreviation:"BRL"},{Symbol:"P",Abbreviation:"BWP"},{Symbol:"руб",Abbreviation:"BYN"},{Symbol:"FrCD",Abbreviation:"CDF"},{Symbol:"CHF",Abbreviation:"CHF"},{Symbol:"CN¥",Abbreviation:"CNY"},{Symbol:"₡",Abbreviation:"CRC"},{Symbol:"CV$",Abbreviation:"CVE"},{Symbol:"Kč",Abbreviation:"CZK"},{Symbol:"Fdj",Abbreviation:"DJF"},{Symbol:"kr",Abbreviation:"DKK"},{Symbol:"RD$",Abbreviation:"DOP"},{Symbol:"دج",Abbreviation:"DZD"},{Symbol:"جم",Abbreviation:"EGP"},{Symbol:"Nfk",Abbreviation:"ERN"},{Symbol:"Br",Abbreviation:"ETB"},{Symbol:"£",Abbreviation:"GBP"},{Symbol:"GEL",Abbreviation:"GEL"},{Symbol:"₵",Abbreviation:"GHS"},{Symbol:"FG",Abbreviation:"GNF"},{Symbol:"Q",Abbreviation:"GTQ"},{Symbol:"L",Abbreviation:"HNL"},{Symbol:"kn",Abbreviation:"HRK"},{Symbol:"Ft",Abbreviation:"HUF"},{Symbol:"Rp",Abbreviation:"IDR"},{Symbol:"₪",Abbreviation:"ILS"},{Symbol:"টকা",Abbreviation:"INR"},{Symbol:"دع",Abbreviation:"IQD"},{Symbol:"﷼",Abbreviation:"IRR"},{Symbol:"دأ",Abbreviation:"JOD"},{Symbol:"￥",Abbreviation:"JPY"},{Symbol:"Ksh",Abbreviation:"KES"},{Symbol:"៛",Abbreviation:"KHR"},{Symbol:"FC",Abbreviation:"KMF"},{Symbol:"₩",Abbreviation:"KRW"},{Symbol:"دك",Abbreviation:"KWD"},{Symbol:"тңг",Abbreviation:"KZT"},{Symbol:"لل",Abbreviation:"LBP"},{Symbol:"SL Re",Abbreviation:"LKR"},{Symbol:"Lt",Abbreviation:"LTL"},{Symbol:"Ls",Abbreviation:"LVL"},{Symbol:"دل",Abbreviation:"LYD"},{Symbol:"دم",Abbreviation:"MAD"},{Symbol:"K",Abbreviation:"MMK"},{Symbol:"RM",Abbreviation:"MYR"},{Symbol:"MTn",Abbreviation:"MZN"},{Symbol:"N$",Abbreviation:"NAD"},{Symbol:"₦",Abbreviation:"NGN"},{Symbol:"C$",Abbreviation:"NIO"},{Symbol:"नेरू",Abbreviation:"NPR"},{Symbol:"رع",Abbreviation:"OMR"},{Symbol:"B/.",Abbreviation:"PAB"},{Symbol:"S/.",Abbreviation:"PEN"},{Symbol:"₱",Abbreviation:"PHP"},{Symbol:"₨",Abbreviation:"PKR"},{Symbol:"zł",Abbreviation:"PLN"},{Symbol:"₲",Abbreviation:"PYG"},{Symbol:"رق",Abbreviation:"QAR"},{Symbol:"дин",Abbreviation:"RSD"},{Symbol:"₽",Abbreviation:"RUB"},{Symbol:"FR",Abbreviation:"RWF"},{Symbol:"رس",Abbreviation:"SAR"},{Symbol:"Ssh",Abbreviation:"SOS"},{Symbol:"لس",Abbreviation:"SYP"},{Symbol:"฿",Abbreviation:"THB"},{Symbol:"دت",Abbreviation:"TND"},{Symbol:"T$",Abbreviation:"TOP"},{Symbol:"TL",Abbreviation:"TRY"},{Symbol:"NT$",Abbreviation:"TWD"},{Symbol:"TSh",Abbreviation:"TZS"},{Symbol:"₴",Abbreviation:"UAH"},{Symbol:"USh",Abbreviation:"UGX"},{Symbol:"Bs.F.",Abbreviation:"VEF"},{Symbol:"₫",Abbreviation:"VND"},{Symbol:"FCFA",Abbreviation:"XAF"},{Symbol:"CFA",Abbreviation:"XOF"},{Symbol:"ري",Abbreviation:"YER"},{Symbol:"R",Abbreviation:"ZAR"},{Symbol:"ZK",Abbreviation:"ZMK"}];async function fetchAndCacheRates(){try{console.log("Fetching data...");const o="https://currency-converter-e1ym.onrender.com/api",e=await fetch(o);if(console.log("Suppppp data..."),!e)throw console.log("Failed to fetch data"),new Error("Failed to fetch data");const t=await e.json(),b={data:t.quotes,timestamp:Date.now()};return console.log("Printing data....: "),console.log(t.quotes),await chrome.storage.local.set({exchangeRates:b}),t.quotes}catch(o){throw console.log("CANT FETCH DATA"),o}}async function convertCurrency(o,e,t){if(e==t)return o;const b=await retrieveCache();let n;return"USD"===e?(console.log("Converting from USD"),n=b[`USD${t}`]):n="USD"===t?1/b[`USD${e}`]:b[`USD${t}`]/b[`USD${e}`],o*n}async function retrieveCache(){const o=(await chrome.storage.local.get(["exchangeRates"])).exchangeRates;return o&&o.data?Date.now()-o.timestamp>288e5?(console.log("Data expired, doing another API call..."),await chrome.storage.local.remove("exchangeRates"),await fetchAndCacheRates()):(console.log("Returning cached data..."),o.data):(console.log("No data found, doing initial API call..."),await fetchAndCacheRates())}async function updateCurrencyFromStorage(){const o=await chrome.storage.local.get(["selectedCurrency"]);o.selectedCurrency&&(defaultToCurrency=o.selectedCurrency,console.log("[Content] Updated default currency to:",defaultToCurrency))}async function extractCurrencyAndAmount(o){const e=o.match(/[\d,\.]+/);let t=null;if(e){const o=e.map((o=>(console.log("HANDLING -> "+o),o.includes(",")&&o.includes(".")?(console.log("Case 1"),o.indexOf(",")<o.indexOf(".")?o.replace(/,/g,""):o.replace(/\./g,"").replace(/,/g,".")):o.includes(",")?(console.log("Case 2"),(o.match(/,/)||[]).length>1?o.replace(/,/g,""):(console.log("2b"),3===o.split(",")[1].length?(console.log("2bi"),o.replace(/,/g,"")):(console.log("2bii"),o.replace(/,/g,".")))):(console.log("Case 3"),1==(o.match(/\./g)||[]).length?3===o.split(".")[1].length?o.replace(/\./g,""):o:o.replace(/\./g,"")))));t=parseFloat(o[0])}let b=o.match(/[A-Z]{3}/);if(b)return b=b[0],"YEN"==b?b="JPY":"CFA"==b?b="XOF":"FCF"==b?b="XAF":"FCD"==b&&(b="CDF"),console.log("Amount: ",t),console.log("Currency: ",b),{currency:b||"UNKNOWN",number:t||0};for(let e=0;e<currencyData.length;e++)if(o.includes(currencyData[e].Symbol))return console.log("Amount: ",t),console.log("Currency: ",currencyData[e].Abbreviation),{currency:currencyData[e].Abbreviation||"UNKNOWN",number:t||0};return{currency:"UNKNOWN",number:t||0}}function createPopup(o,e,t){var b=document.createElement("div");b.style.position="fixed",b.style.top=e.top-50+"px",b.style.left=e.left+"px",b.style.backgroundColor="#fff",b.style.color="green",b.style.border="1px solid #000",b.style.padding="10px",b.style.zIndex=999999;var n=document.createElement("div");return n.textContent=t?defaultToCurrency+" "+o:o,b.appendChild(n),b.id="myPopup",b}document.addEventListener("mouseup",(async o=>{var e=window.getSelection(),t=e.toString().trim();if(console.log("[Content] selection: "+e),t&&""!==t){var b=e.getRangeAt(0).getBoundingClientRect();try{await updateCurrencyFromStorage();const o=await extractCurrencyAndAmount(t);let e=null,n=!0;"UNKNOWN"==o.currency?(e="Currency not recognized",n=!1):e=await convertCurrency(o.number,o.currency,defaultToCurrency),n&&(e=e.toFixed(2));const i=createPopup(e,b,n);document.body.appendChild(i),document.addEventListener("mousedown",(function(o){i.contains(o.target)||(i.parentNode.removeChild(i),document.removeEventListener("mousedown",arguments.callee))}))}catch(o){throw o}}}));