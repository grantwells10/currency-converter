import{API_KEY}from"./config.js";async function fetchAndCacheRates(){try{const e=`http://api.currencylayer.com/live?access_key=${API_KEY}`,t=await fetch(e);if(!t)throw new Error("Failed to fetch data");const r=await t.json().quotes,a={data:r,timestamp:Date.now()};return await chrome.storage.local.set({exchangeRates:a}),r}catch(e){return console.log(e),null}}async function convertCurrency(e,t,r){const a=await retrieveCache("exchangeRates");let c;return c="USD"===t?a[`USD${r}`]:a[`USD${r}`]/a[`USD${t}`],e*c}async function retrieveCache(){return new Promise(((e,t)=>{chrome.storage.local.get(["exchangeRates"],(function(r){if(chrome.runtime.lastError)return void t(chrome.runtime.lastError);const a=r.exchangeRates;a?Date.now()-a.timestamp>288e5?chrome.storage.local.remove("exchangeRates",(function(){chrome.runtime.lastError?t(chrome.runtime.lastError):e(fetchAndCacheRates())})):e(a.data):e(fetchAndCacheRates())}))}))}async function extractCurrencyAndAmount(e){const t=e.match(/[A-Z]{3}/),r=e.match(/[\d,]+\.?\d*/);let a=null;return r&&(a=parseFloat(r[0].replace(/,/g,""))),{currency:t?t[0]:null,number:a||null}}